{% extends ./master.html %}

{%block css %}
<style>
@import url(http://fonts.googleapis.com/css?family=Lato:400,700);

.profile 
{
    min-height: 355px;
    display: inline-block;
    }
figcaption.ratings
{
    margin-top:20px;
    }
figcaption.ratings a
{
    color:#f1c40f;
    font-size:11px;
    }
figcaption.ratings a:hover
{
    color:#f39c12;
    text-decoration:none;
    }
.divider 
{
    border-top:1px solid rgba(0,0,0,0.1);
    }
.emphasis 
{
    border-top: 4px solid transparent;
    }
.emphasis:hover 
{
    border-top: 4px solid #1abc9c;
    }
.emphasis h2
{
    margin-bottom:0;
    }
span.tags 
{
    background: #1abc9c;
    border-radius: 2px;
    color: #f5f5f5;
    font-weight: bold;
    padding: 2px 4px;
    }

.dropup .dropdown-menu 
{
    margin-bottom:10px;
    }
.dropup .dropdown-menu:before 
{
    content: "";
    border-top: 10px solid #34495e;
    border-right: 10px solid transparent;
    border-left: 10px solid transparent;
    position: absolute;
    bottom: -10px;
    left: 50%;
    margin-left: -10px;
    z-index: 10;
    }
</style>
{% end %}

{% block container %}
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
	<div class="row">
		<div class="col-md-offset-2 col-md-8 col-lg-offset-3 col-lg-6">
    	 <div class="well profile">
            <div class="col-sm-12">
                <div class="col-xs-12 col-sm-8">
                    <h2>Nicole Pearson</h2>
                    <p><strong>About: </strong> Web Designer / UI. </p>
                    <p><strong>Hobbies: </strong> Read, out with friends, listen to music, draw and learn new things. </p>
                    <p><strong>Skills: </strong>
                        <span class="tags">html5</span> 
                        <span class="tags">css3</span>
                        <span class="tags">jquery</span>
                        <span class="tags">bootstrap3</span>
                    </p>
                </div>             
                <div class="col-xs-12 col-sm-4 text-center">
                    <figure>
                        <img src="http://www.localcrimenews.com/wp-content/uploads/2013/07/default-user-icon-profile.png" alt="" class="img-circle img-responsive">
                        <figcaption class="ratings">
                            <p>Ratings
                            <a href="#">
                                <span class="fa fa-star"></span>
                            </a>
                            <a href="#">
                                <span class="fa fa-star"></span>
                            </a>
                            <a href="#">
                                <span class="fa fa-star"></span>
                            </a>
                            <a href="#">
                                <span class="fa fa-star"></span>
                            </a>
                            <a href="#">
                                 <span class="fa fa-star-o"></span>
                            </a> 
                            </p>
                        </figcaption>
                    </figure>
                </div>
            </div>            
            <div class="col-xs-12 divider text-center">
                <div class="col-xs-12 col-sm-4 emphasis">
                    <h2><strong> 20,7K </strong></h2>                    
                    <p><small>Followers</small></p>
                    <button class="btn btn-success btn-block"><span class="fa fa-plus-circle"></span> Follow </button>
                </div>
                <div class="col-xs-12 col-sm-4 emphasis">
                    <h2><strong>245</strong></h2>                    
                    <p><small>Following</small></p>
                    <button class="btn btn-info btn-block"><span class="fa fa-user"></span> View Profile </button>
                </div>
                <div class="col-xs-12 col-sm-4 emphasis">
                    <h2><strong>43</strong></h2>                    
                    <p><small>Snippets</small></p>
                    <div class="btn-group dropup btn-block">
                      <button type="button" class="btn btn-primary"><span class="fa fa-gear"></span> Options </button>
                      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <ul class="dropdown-menu text-left" role="menu">
                        <li><a href="#"><span class="fa fa-envelope pull-right"></span> Send an email </a></li>
                        <li><a href="#"><span class="fa fa-list pull-right"></span> Add or remove from a list  </a></li>
                        <li class="divider"></li>
                        <li><a href="#"><span class="fa fa-warning pull-right"></span>Report this user for spam</a></li>
                        <li class="divider"></li>
                        <li><a href="#" class="btn disabled" role="button"> Unfollow </a></li>
                      </ul>
                    </div>
                </div>
            </div>
    	 </div>                 
		</div>
	</div>
	{% for d in drums %}
	<div id="{{d}}" class="row">
		<div class="col-md-4">
			<div class="gauge epoch category10" style="height: 200px;"></div>
		</div>
		<div class="col-md-8">
			<div class="line epoch category10" style="height: 200px;"></div>					
		</div>
	</div>
	{% end %}
	<div id="area" class="epoch category10" style="height: 200px;"></div>
	<div id="output">
	
	</div>

{% end %}

{%block javascript %}
<script type="text/javascript">
	var wsUri = "ws://localhost:8888/stream"; 
	var output;  
	function init() { 
		output = document.getElementById("output"); 
		testWebSocket(); 
	}  
	function testWebSocket() { 
		websocket = new WebSocket(wsUri); 
		websocket.onopen = function(evt) { 
			onOpen(evt) }; 
		websocket.onclose = function(evt) { 
			onClose(evt) }; 
		websocket.onmessage = function(evt) { 
			onMessage(evt) }; 
		websocket.onerror = function(evt) { 
			onError(evt) }; }  
		function onOpen(evt) { 
			writeToScreen("CONNECTED"); 
			doSend("WebSocket rocks"); }  
		function onClose(evt) { 
			writeToScreen("DISCONNECTED"); 
		}  
		function onMessage(evt) { 
			try{
				var data = JSON.parse(evt.data); 
				if(charts.hasOwnProperty(data['mac'])){
					charts[data['mac']]['gauge'].push(0.8);
					charts[data['mac']]['line'].push(
					[{time:parseFloat(data['time']),y:parseFloat(data['level'])}]);
				}
				
			}catch(e){
				console.log(e);
			}
			writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>'); 
			//websocket.close(); 
		}  
		function onError(evt) { 
			writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data); 
		}  
		function doSend(message) { 
			writeToScreen("SENT: " + message);  
			websocket.send(message); 
		}  
		function writeToScreen(message) { 
			var pre = document.createElement("p"); 
			pre.style.wordWrap = "break-word"; 
			pre.innerHTML = message; 
			output.appendChild(pre); 
		}  
		
		window.addEventListener("load", init, false); 
		var drums = JSON.parse('{% raw json_drums %}');
		var charts = {};
		
		for (var d in drums){
		 	var element = $('[id="'+d+'"]');
		 	for(var e in drums[d]){
		 		drums[d][e]['y'] = parseFloat(drums[d][e]['level']);
		 		drums[d][e]['time'] = parseFloat(drums[d][e]['time']);
		 	};
			charts[d] = {
				'gauge':element.find('.gauge').epoch({type: 'time.gauge',
		    		value: 0.5
	  			}),
  				'line':element.find('.line').epoch({type: 'time.line',
  					axes:['left','bottom','right'],
  					data:[{
  						'label':'level',
  						'values':drums[d]
  						}]
  				}),
  				 			
  			};
  			
		}
		
		
		
		
				
</script>

{% end %}